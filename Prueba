import React, { useEffect, useState } from "react";
import { FaUser } from "react-icons/fa"; // Importamos el icono FaUser de FontAwesome
import "../styles/TopBar.css"; // Ajusta la ruta de los estilos segÃºn sea necesario
import logo from "../imgs/OIP.jfif";
import styled from "styled-components";
import CryptoJS from "crypto-js"; // Importa CryptoJS

const Image = styled.img`
  width: 100%;
  height: auto;
`;

const TopBar = ({ userName }) => {
  const [username, setUsername] = useState('');
  const secretKey = 'mySecretKey'; // La misma clave secreta para desencriptar

  const decryptData = (encryptedData) => {
    try {
      const bytes = CryptoJS.AES.decrypt(encryptedData, secretKey);
      const decryptedData = bytes.toString(CryptoJS.enc.Utf8);
      console.log("Desencriptado:", decryptedData); // Verifica el valor desencriptado
      return decryptedData;
    } catch (error) {
      console.error("Error al desencriptar:", error);
      return '';
    }
  };

  useEffect(() => {
    const encryptedUsername = localStorage.getItem('username');
    console.log("Encriptado en localStorage:", encryptedUsername); // Verifica el valor almacenado
    if (encryptedUsername) {
      const decryptedUsername = decryptData(encryptedUsername);
      setUsername(decryptedUsername);
    }
  }, []);

  return (
    <div className="top-bar">
      <div className="nav">
        <a href="/landingPage" style={{ textDecoration: 'none' }}>
          <Image src={logo} />
        </a>
      </div>
      <div className="nav-brand">
        <a href="/landingPage" style={{ textDecoration: 'none' }}>
          <h2 className="icon">Ficohsa</h2>
        </a>
      </div>
      <div className="top-bar-right">
        <FaUser className="user-icon" />
        <p className="user-name">{username}</p>
      </div>
    </div>
  );
};

export default TopBar;